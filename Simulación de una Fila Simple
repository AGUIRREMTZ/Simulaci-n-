import random
import matplotlib.pyplot as plt

# Parámetros de simulación
tasa_llegada = 1/5   # un cliente cada 5 minutos en promedio
tasa_servicio = 1/4   # servicio promedio de 4 minutos por cliente
tiempo_simulacion = 200  # duración total (en minutos)

# Variables de estado
reloj = 0
cola = []
servidor_ocupado = False
tiempo_prox_llegada = random.expovariate(tasa_llegada)
tiempo_prox_salida = float('inf')
tiempos_espera = []
clientes_atendidos = 0
uso_servidor = 0

# Listas para graficar
tiempos = []
longitud_cola = []

# Simulación
while reloj < tiempo_simulacion:
    if tiempo_prox_llegada <= tiempo_prox_salida:
        reloj = tiempo_prox_llegada
        if not servidor_ocupado:
            servidor_ocupado = True
            tiempo_prox_salida = reloj + random.expovariate(tasa_servicio)
        else:
            cola.append(reloj)
        tiempo_prox_llegada = reloj + random.expovariate(tasa_llegada)
    else:
        reloj = tiempo_prox_salida
        clientes_atendidos += 1
        uso_servidor += tiempo_prox_salida - (cola[0] if cola else reloj)
        if cola:
            llegada_cliente = cola.pop(0)
            tiempos_espera.append(reloj - llegada_cliente)
            tiempo_prox_salida = reloj + random.expovariate(tasa_servicio)
        else:
            servidor_ocupado = False
            tiempo_prox_salida = float('inf')

    tiempos.append(reloj)
    longitud_cola.append(len(cola))

# Resultados
print("\n--- RESULTADOS DE LA SIMULACIÓN ---")
print(f"Clientes atendidos: {clientes_atendidos}")
print(f"Tiempo promedio de espera: {sum(tiempos_espera)/len(tiempos_espera):.2f} minutos")
print(f"Utilización del servidor: {(uso_servidor / reloj):.2f}")
print(f"Longitud promedio de la cola: {sum(longitud_cola)/len(longitud_cola):.2f}")

# Gráfica
plt.plot(tiempos, longitud_cola, color='blue')
plt.title("Evolución de la longitud de la cola en el tiempo")
plt.xlabel("Tiempo (minutos)")
plt.ylabel("Clientes en cola")
plt.grid(True)
plt.show()
